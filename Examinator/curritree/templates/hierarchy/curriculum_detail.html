{% extends "base.html" %}

{% block content %}
<div class="max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8 space-y-6">
  
  {% if breadcrumb %}
  <nav class="flex text-sm font-medium text-gray-500 dark:text-gray-400" aria-label="Breadcrumb">
    <ol class="inline-flex items-center space-x-2">
      <li class="inline-flex items-center">
        <a href="{% url 'curritree:curriculum_list' %}" class="hover:text-blue-600 dark:hover:text-blue-400">
          <i class="fa-solid fa-layer-group mr-1"></i> Root
        </a>
      </li>
      {% for item in breadcrumb %}
      <li>
        <div class="flex items-center">
          <i class="fa-solid fa-chevron-right text-xs mx-2"></i>
          {% if forloop.last %}
            <span class="text-gray-700 dark:text-gray-300">{{ item.name }}</span>
          {% else %}
            <a href="{% url 'curritree:curriculum_detail' pk=item.pk %}" class="hover:text-blue-600 dark:hover:text-blue-400">{{ item.name }}</a>
          {% endif %}
        </div>
      </li>
      {% endfor %}
    </ol>
  </nav>
  {% endif %}

  <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 border-l-4 border-blue-500">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-3">
      <!-- Left section -->
      <div>
        {% if node.parent %}
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Parent: 
            <span class="font-medium text-gray-700 dark:text-gray-200">
              {{ node.parent.name }}
            </span>
          </p>
        {% endif %}
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
          {{ node.name }}
        </h2>
      </div>

      {% if node.marks %}
       <span class="self-start sm:self-center px-3 py-1 text-sm font-semibold rounded-full 
                  bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
         Marks : {{ node.marks }}
      </span>
      {% endif %}

      <!-- Right section (node type badge) -->
      <span class="self-start sm:self-center px-3 py-1 text-sm font-semibold rounded-full 
                  bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300">
        {{ node.node_type|upper }}
      </span>
      
    </div>

    {% if node.metadata %}
    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
        <h3 class="text-sm font-semibold uppercase text-gray-500 dark:text-gray-400 mb-2">Metadata</h3>
        <div class="flex flex-wrap gap-2">
            {% for key, value in node.metadata.items %}
                <span class="text-xs px-2.5 py-0.5 rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300">
                    {{ key }}: <strong class="font-medium">{{ value }}</strong>
                </span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
  </div>

  <div class="flex flex-wrap gap-3">
    
    <a href="{% url 'curritree:create_child_node' parent_pk=node.pk %}"
       class="inline-flex items-center gap-2 px-5 py-2.5 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 transition shadow-md">
      <i class="fa-solid fa-plus-circle"></i> Add {% if node.node_type == 'board' %} Class {% elif node.node_type == 'competitive' or node.node_type == 'class' %} Subject {% elif node.node_type == 'subject' %} Chapter/Unit {% elif node.node_type == 'uint' %} Chapter {% else %} {# No Add Child button for 'chapter' nodes #}{% endif %}
    </a>

    <a href="{% url 'curritree:curriculum_edit' pk=node.pk %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-yellow-500 text-white font-medium hover:bg-yellow-600 transition shadow-md">
      <i class="fa-solid fa-pen"></i> Edit Node
    </a>
    
    <a href="{% url 'curritree:curriculum_delete' pk=node.pk %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-red-600 text-white font-medium hover:bg-red-700 transition shadow-md">
      <i class="fa-solid fa-trash"></i> Delete Node
    </a>
    
    <a href="{% url 'curritree:curriculum_list' %}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-600 text-white font-medium hover:bg-gray-700 transition shadow-md">
      <i class="fa-solid fa-arrow-left"></i> Back to List
    </a>
  </div>
  
  ---
  
  <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6">
      <h3 class="text-xl font-bold text-gray-900 dark:text-gray-50 mb-4">
        Children of {{ node.name }} ({{ children|length }})
      </h3>
      
      {% if children %}
      <ul class="divide-y divide-gray-200 dark:divide-gray-700">
          {% for child in children %}
          <li class="py-3 flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-700 transition px-2 -mx-2 rounded-lg">
              <div class="flex items-center space-x-3">
                  <span class="text-sm font-semibold px-2 py-1 rounded-full bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-300">
                      {{ child.order }}
                  </span>
                  <a href="{% url 'curritree:curriculum_detail' pk=child.pk %}" class="text-lg font-medium text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400">
                      {{ child.name }}
                  </a>
              </div>
              <span class="text-sm text-gray-500 dark:text-gray-400">
                  {{ child.node_type|capfirst }}
              </span>
          </li>
          {% endfor %}
      </ul>
      {% else %}
      <p class="text-gray-500 dark:text-gray-400 italic">
          No child nodes found for "{{ node.name }}". Be the first to add one!
      </p>
      {% endif %}
  </div>

</div>
{% endblock %}