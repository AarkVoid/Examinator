{% load static %}
{% load custom_filters %} 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}EduPlatform{% endblock %}</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="EduPlatform - Your online learning hub" name="keywords">
  <meta content="Empowering education with interactive tools and comprehensive resources." name="description">

  <link href="{% static 'img/favicon.ico' %}" rel="icon">
  {# Self-hosted Google Fonts - Make sure static/css/fonts.css contains your @font-face rules #}
  {% comment %} <link href="{% static 'css/fonts.css' %}" rel="stylesheet"> {% endcomment %}
  {# Self-hosted Font Awesome - Make sure static/fontawesome/css/all.min.css is present #}
  <link href="{% static 'fontawesome/css/all.min.css' %}" rel="stylesheet">

  {# NEW: Custom Sidebar CSS #}
  <link href="{% static 'css/sidebar.css' %}" rel="stylesheet">

  {# Your existing project's general CSS - if you have one, make sure it's here #}
  <link href="{% static 'css/style.css' %}" rel="stylesheet">

  {% block head %}{% endblock %}
</head>
<body>
    {# The main layout container for the app, enabling side-by-side layout #}
    <div class="app-layout">
        {# The vertical sidebar navigation #}
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="{% url 'home' %}" class="sidebar-brand">
                    <h1 class="m-0 text-uppercase text-primary"><i class="fa fa-book-reader mr-3"></i>Edukate</h1>
                </a>
                {# Button to toggle the sidebar (e.g., for mobile) #}
                <button class="sidebar-toggle-btn" aria-label="Toggle sidebar">
                    <i class="fas fa-bars" ></i>
                </button>
            </div>

            {% if request.user.is_authenticated %}
            {# Profile Card - only displayed if user is logged in #}
            <div class="profile-card">
                <div class="profile-image">
                  <img src="{% if request.user.profile.pic %}{{ request.user.profile.pic.url }}{% else %}{% static 'img/default-profile.png' %}{% endif %}"
                       alt="User Profile Picture">
                </div>
                <div class="profile-info">
                  <h2 class="profile-name">{{ request.user.username }}</h2>
                  <span class="profile-role">{{ request.user.role|title }}</span>
                  {% if request.user.profile.institute %}
                    <p class="profile-inst"><i class="fas fa-school"></i> {{ request.user.profile.institute.name }}</p>
                  {% endif %}

                  <a href="{% url 'profile_update' %}" class="profile-action-btn">
                    <i class="fas fa-user-circle"></i> <span class="nav-text">View/Edit Profile</span>
                  </a>

                  <a href="{% url 'logout' %}" class="profile-action-btn btn-logout">
                    <i class="fas fa-sign-out-alt"></i> <span class="nav-text">Logout</span>
                  </a>
                </div>
            </div>
            {% endif %}

            <nav class="sidebar-menu">
                <ul class="main-nav">
                    {# Always visible for authenticated users #}
                    {% if request.user.is_authenticated  %}
                        
                        {% if request.user.role != 'teacher' %}
                            <li class="nav-item has-dropdown">
                                <a href="#" class="nav-link dropdown-toggle" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-university nav-icon"></i> <span class="nav-text">Institution</span> <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    {# Links for Admins and Main Admins #}
                                    {% if request.user|check_permissions:"institute.view_institutionpasskey|or" %}
                                        <li><a href="{% url 'passkey_list' %}"><i class="fas fa-fingerprint nav-icon"></i> <span class="nav-text">View Passkeys</span></a></li>
                                        <li><a href="{% url 'passkey_create' %}"><i class="fas fa-key nav-icon"></i> <span class="nav-text">Add Passkey</span></a></li>
                                        <li class="dropdown-divider"></li>
                                        <li><a href="{% url 'manage_applications' %}"><i class="fas fa-clipboard-check nav-icon"></i> <span class="nav-text">Manage Applications</span></a></li>
                                        <li><a href="{% url 'institution_create' %}"><i class="fas fa-plus nav-icon"></i> <span class="nav-text">Add Institution</span></a></li>
                                        {% if not request.user.is_superuser %}
                                            <li><a href="{% url 'manage_institute_users' %}"><i class="fas fa-users nav-icon"></i> <span class="nav-text">Manage Institute Users</span></a></li>
                                        {% endif %}
                                    {% endif %}

                                    {% if request.user.role == "main_admin" %}
                                        <li><a href="{% url 'manage_institution_group' group_id=request.user.profile.institute_group.pk %}"><i class="fas fa-building nav-icon"></i> <span class="nav-text">View Institutions</span></a></li>
                                    {% endif %}

                                    {% if request.user|has_access:'' %}
                                        <li><a href="{% url 'institution_list' %}"><i class="fas fa-building nav-icon"></i> <span class="nav-text">View Institutions</span></a></li>
                                        <li><a href="{% url 'list-institution-groups' %}"><i class="fas fa-building nav-icon">  </i> <span class="nav-text">View Groups</span></a></li>
                                    {% endif %}

                                    {# Links for Institute Admins #}
                                    {% if not request.user.is_superuser %}
                                        {% if request.user.role == 'admin' %}
                                            <li class="dropdown-divider"></li>
                                            <li><a href="{% url 'add_teacher' %}"><i class="fas fa-user-plus nav-icon"></i> <span class="nav-text">Add Teacher</span></a></li>
                                        {% endif %}
                                        {% if request.user.role == 'main_admin' %}
                                            <li class="dropdown-divider"></li>
                                            <li><a href="{% url 'create_admin' %}"><i class="fas fa-user-plus nav-icon"></i> <span class="nav-text">Add Teacher</span></a></li>
                                        {% endif %}
                                    {% endif %}


                                    {# Links for Students and Teachers #}
                                    {% if request.user.role == 'student' %}
                                        <li><a href="{% url 'apply_for_institute' %}"><i class="fas fa-paper-plane nav-icon"></i> <span class="nav-text">Apply for Institute</span></a></li>
                                        <li><a href="{% url 'student_applications_status' %}"><i class="fas fa-check-circle nav-icon"></i> <span class="nav-text">Application Status</span></a></li>
                                    {% endif %}
                                </ul>
                            </li>
                        {% endif %}
              
                        {% if request.user|has_access:"admin,teacher,main_admin" %}
                            <li><a href="{% url 'lesson_list' %}"><i class="fas fa-book-open nav-icon"></i> <span class="nav-text">Lesson</span></a></li>
                            
                        
                        
                            {% if request.user|has_access:"admin,main_admin" %}
                                <li><a href="{% url 'education_dashboard' %}"><i class="fas fa-graduation-cap nav-icon"></i> <span class="nav-text">Education</span></a></li>
                                <li class="nav-item has-dropdown">
                                    <a href="#" class="nav-link dropdown-toggle" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-map-marker-alt nav-icon"></i> <span class="nav-text">Location</span> <i class="fas fa-chevron-down dropdown-arrow"></i>
                                    </a>
                                    
                                </li>
                                
                            {% endif %}

                        
                            <li class="nav-item has-dropdown">
                                <a href="#" class="nav-link dropdown-toggle" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-question-circle nav-icon"></i> <span class="nav-text">Quizzes</span> <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    
                                    
                                        <li><a href="{% url 'paper_list' %}"><i class="fas fa-list-alt nav-icon"></i> <span class="nav-text">Quiz List</span></a></li>
                                    
                                    
                                        <li class="dropdown-divider"></li>
                                        {% if request.user.role != 'teacher' %}
                                            <li><a href="{% url 'tag_management' %}"><i class="fas fa-tags nav-icon"></i> <span class="nav-text">Manage Tags</span></a></li>
                                        {% endif %}
                                        <li><a href="{% url 'paper_create' %}"><i class="fas fa-plus-square nav-icon"></i> <span class="nav-text">Add APaper</span></a></li>
                                        <li><a href="{% url 'question_list' %}"><i class="fas fa-clipboard-question nav-icon"></i> <span class="nav-text">Question List</span></a></li>
                                        <li><a href="{% url 'question_create' %}"><i class="fas fa-pen nav-icon"></i> <span class="nav-text">Add Question</span></a></li>
                                
                                </ul>
                            </li>
                        {% endif %}
                    
                        
                        <li><a href="{% url 'add_comment' %}"><i class="fas fa-comment-dots nav-icon"></i> <span class="nav-text">Add Comment</span></a></li>
                        <li><a href="{% url 'view_comments' %}"><i class="fas fa-comment-dots nav-icon"></i> <span class="nav-text">view Comment</span></a></li>
                    

                    

                        {% if request.user.role == 'admin' %}
                            <li><a href="{% url 'view_contact_messages' %}"><i class="fas fa-envelope nav-icon"></i> <span class="nav-text">View Mail</span></a></li>
                        {% endif %}

                        {% if request.user|has_access:" " %}
                        <li class="nav-item has-dropdown">
                            <a href="#" class="nav-link dropdown-toggle" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-users-cog nav-icon"></i> <span class="nav-text">User Management</span> <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url 'manage_users' %}"><i class="fas fa-user-shield nav-icon"></i> <span class="nav-text">Manage All Users</span></a></li>
                                <li><a href="{% url 'group_list' %}"><i class="fas fa-users nav-icon"></i> <span class="nav-text">Manage Groups</span></a></li>
                            </ul>
                        </li>
                        {% endif %}
                    {% endif %}
                    <li><a href="{% url 'contact_us' %}"><i class="fas fa-envelope nav-icon"></i> <span class="nav-text">Contact Us</span></a></li>
                </ul>
            </nav>

            {% if not request.user.is_authenticated %}
                <div class="sidebar-auth-links">
                    <a href="{% url 'login' %}" class="btn btn-secondary"><i class="fas fa-sign-in-alt nav-icon"></i> <span class="nav-text">Login</span></a>
                    <a href="{% url 'register' %}" class="btn btn-success"><i class="fas fa-user-plus nav-icon"></i> <span class="nav-text">Register</span></a>
                    <a href="{% url 'resend_verification' %}" class="btn btn-primary"><i class="fas fa-user-plus nav-icon"></i> <span class="nav-text">Resend Verification</span></a>
                </div>
            {% endif %}
        </aside>

        {# The main content area #}
        <main class="main-content" id="main-content">
            {# A top bar might be useful here for a mobile toggle or page title #}
            <div class="top-bar">
                <button class="mobile-sidebar-toggle-btn" aria-label="Toggle sidebar menu">
                    <i class="fas fa-bars" style="color: #007bff;"></i>
                </button>
                <h2 class="page-title">{% block page_title %}{% endblock %}</h2> {# Placeholder for dynamic page title #}
            </div>

            {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                        <div class="message-item {{ message.tags }}">
                            <i class="fas fa-info-circle mr-2"></i> {{ message }} {# Changed icon to info-circle for generic message #}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            {% block content %}{% endblock %}
        </main>
    </div>

    {# --- LOAD JQUERY FIRST --- #}
    <script src="{% static 'js/jquery-3.4.1.min.js' %}"></script>

    {# Custom Sidebar JavaScript - This uses pure JS, so jQuery is not needed for its *own* function #}
    {# but it will execute AFTER jQuery, so it's fine. #}
    <script src="{% static 'js/sidebar.js' %}"></script>

    {# Your other project's JS files (which depend on jQuery) #}
    {# REMOVE these if they are not present in your static/lib/ directory #}
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/counterup/counterup.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
     {# Keep this if you have or plan to add general JS #}
    {% block Script %}{% endblock %}
    {% block extra_filters %}{% endblock %} {# Placeholder for loading custom template filters #}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const messageItems = document.querySelectorAll('.messages-container .message-item');
            const displayTime = 5000; // Time in milliseconds (5 seconds)
            const fadeOutTime = 500; // Time for the fade-out transition (0.5 seconds)

            messageItems.forEach(item => {
                // Set a timeout to start the fade-out animation
                setTimeout(() => {
                    item.classList.add('fade-out');
                    // After the fade-out transition, remove the element from the DOM
                    setTimeout(() => {
                        item.remove();
                    }, fadeOutTime); // This timeout matches the CSS transition duration
                }, displayTime);
            });
        });

        // JavaScript for Dropdown Menus
        document.querySelectorAll('.nav-item.has-dropdown > .nav-link').forEach(dropdownToggle => {
            dropdownToggle.addEventListener('click', function(e) {
                e.preventDefault();
                const dropdownMenu = this.nextElementSibling;
                if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
                    dropdownMenu.classList.toggle('show');
                    this.setAttribute('aria-expanded', dropdownMenu.classList.contains('show'));
                }
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            document.querySelectorAll('.dropdown-menu.show').forEach(openMenu => {
                const parentNav = openMenu.closest('.nav-item.has-dropdown');
                if (!parentNav.contains(e.target)) {
                    openMenu.classList.remove('show');
                    openMenu.previousElementSibling.setAttribute('aria-expanded', 'false');
                }
            });
        });

        // Close dropdowns when a dropdown item is clicked (optional, but often desired)
        document.querySelectorAll('.dropdown-menu a').forEach(item => {
            item.addEventListener('click', function() {
                const openMenu = this.closest('.dropdown-menu');
                if (openMenu) {
                    openMenu.classList.remove('show');
                    openMenu.previousElementSibling.setAttribute('aria-expanded', 'false');
                }
            });
        });
    </script>
</body>
</html>
