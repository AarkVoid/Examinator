{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Hub{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="border-b border-gray-200 dark:border-gray-700 pb-4">
    <h1 class="text-4xl font-extrabold text-gray-900 dark:text-gray-50">
      {% if is_superuser %}
        Superuser Admin Hub
      {% else %}
        Organization Admin Hub
      {% endif %}
    </h1>
    <p class="text-gray-500 dark:text-gray-400 mt-2">
      Quickly access all management tools for users, content, and system configurations.
    </p>
  </div>

  <!-- Organization Overview Card (If not Superuser) -->
  {% if organization %}
  <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border-l-4 border-blue-600 my-6">
    <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-2">
      Managing: {{ organization.name }}
    </h2>
    <p class="text-gray-600 dark:text-gray-400">
      Organization ID: <span class="font-mono text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">{{ organization.pk }}</span>
    </p>
  </div>
  {% endif %}

  <!-- === NEW TAB NAVIGATION === -->
  <div class="mb-6">
    <div class="border-b border-gray-200 dark:border-gray-700">
      <nav class="-mb-px flex space-x-8" aria-label="Tabs">
        <!-- Tab 1: Admin Hub -->
        <a href="?tab=hub" class="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm
          {% if current_tab == 'hub' %}
            border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400
          {% else %}
            border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600
          {% endif %}">
          <i class="fa-solid fa-compass mr-2"></i>
          <span>Admin Hub</span>
        </a>

        <!-- Tab 2: License & Usage -->
        <a href="?tab=license" class="group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm
          {% if current_tab == 'license' %}
            border-blue-600 text-blue-600 dark:border-blue-400 dark:text-blue-400
          {% else %}
            border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600
          {% endif %}">
          <i class="fa-solid fa-key mr-2"></i>
          <span>License & Usage</span>
        </a>
      </nav>
    </div>
  </div>

  <!-- === TAB CONTENT === -->
  <div>
    
    <!-- Tab Panel 1: Admin Hub -->
    <div id="tab-hub-content" class="{% if current_tab != 'hub' %}hidden{% endif %} space-y-8">
        
      <!-- Organization Metric Cards (Now includes Subject and Chapter Counts) -->
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
        
        <!-- Total Users -->
        <div class="metric-card border-indigo-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Users</p>
                <p class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">{{ org_metrics.total_org_users|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-users text-2xl text-indigo-600 dark:text-indigo-400"></i>
        </div>

        <!-- Total Questions -->
        <div class="metric-card border-green-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Questions</p>
                <p class="text-3xl font-bold text-green-600 dark:text-green-400">{{ org_metrics.total_org_questions|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-question text-2xl text-green-600 dark:text-green-400"></i>
        </div>

        <!-- Total Papers (Published + Draft) -->
        <div class="metric-card border-blue-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Papers</p>
                <p class="text-3xl font-bold text-blue-600 dark:text-blue-400">{{ org_metrics.current_papers_count|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-file-lines text-2xl text-blue-600 dark:text-blue-400"></i>
        </div>

        <!-- Total Draft Papers -->
        <div class="metric-card border-yellow-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Draft Papers</p>
                <p class="text-3xl font-bold text-yellow-600 dark:text-yellow-400">{{ org_metrics.current_draft_papers_count|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-folder-open text-2xl text-yellow-600 dark:text-yellow-400"></i>
        </div>

        <!-- NEW: Total Subjects Count -->
        <div class="metric-card border-purple-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Subjects</p>
                <p class="text-3xl font-bold text-purple-600 dark:text-purple-400">{{ org_metrics.total_subjects_count|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-book-open text-2xl text-purple-600 dark:text-purple-400"></i>
        </div>

        <!-- NEW: Total Chapters Count -->
        <div class="metric-card border-red-500">
            <div class="space-y-1">
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Chapters</p>
                <p class="text-3xl font-bold text-red-600 dark:text-red-400">{{ org_metrics.total_chapters_count|default:"0" }}</p>
            </div>
            <i class="fa-solid fa-list-check text-2xl text-red-600 dark:text-red-400"></i>
        </div>
      </div>
        
      <!-- Main Navigation Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

        <!-- 1. USER MANAGEMENT SECTION -->
        <div class="lg:col-span-1 space-y-4">
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">User Management</h2>
          <div class="space-y-3">
            <a href="{% if organization %}{% url 'view_organization_users_list' org_pk=org_pk %}{% else %}{% url 'manage_users' %}{% endif %}" class="admin-link-card">
              <i class="fa-solid fa-users text-3xl text-indigo-500 mr-4"></i>
              <div>
                <p class="font-semibold">Manage Users</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">View, edit, and delete user accounts.</p>
              </div>
            </a>
            <a href="{% if organization %}{% url 'create_user_by_admin' org_pk=org_pk %}{% else %}{% url 'register' %}{% endif %}" class="admin-link-card">
              <i class="fa-solid fa-user-plus text-3xl text-indigo-500 mr-4"></i>
              <div>
                <p class="font-semibold">Create New User</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Register new accounts within your organization.</p>
              </div>
            </a>
            <a href="{% url 'manage_groups' %}" class="admin-link-card">
              <i class="fa-solid fa-layer-group text-3xl text-indigo-500 mr-4"></i>
              <div>
                <p class="font-semibold">Manage Groups & Permissions</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Define user roles and access groups.</p>
              </div>
            </a>
          </div>
        </div>
        
        <!-- 2. CONTENT MANAGEMENT SECTION -->
        <div class="lg:col-span-1 space-y-4">
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">Content Management</h2>
          <div class="space-y-3">
            <a href="{% url 'quiz:paper_list' %}" class="admin-link-card">
              <i class="fa-solid fa-file-lines text-3xl text-green-500 mr-4"></i>
              <div>
                <p class="font-semibold">Quiz Papers</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">View and manage drafts and published papers.</p>
              </div>
            </a>
            <a href="{% url 'quiz:question_list' %}" class="admin-link-card">
              <i class="fa-solid fa-question text-3xl text-green-500 mr-4"></i>
              <div>
                <p class="font-semibold">Question Bank ({{ total_question_count|default:"0" }})</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Manage all individual questions.</p>
              </div>
            </a>
            <a href="{% url 'curritree:curriculum_list' %}" class="admin-link-card">
              <i class="fa-solid fa-sitemap text-3xl text-green-500 mr-4"></i>
              <div>
                <p class="font-semibold">Curriculum Tree</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Manage subjects, chapters, and topics hierarchy.</p>
              </div>
            </a>
          </div>
        </div>
        
        <!-- 3. COMMUNICATIONS & SUPPORT -->
        <div class="lg:col-span-1 space-y-4">
          <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">Communications</h2>
          <div class="space-y-3">
            <a href="{% url 'message_list' %}" class="admin-link-card">
              <i class="fa-solid fa-envelope text-3xl text-yellow-500 mr-4"></i>
              <div>
                <p class="font-semibold">Internal Messages</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">View direct messages between users.</p>
              </div>
            </a>
            <a href="{% url 'view_comments' %}" class="admin-link-card">
              <i class="fa-solid fa-comment-dots text-3xl text-yellow-500 mr-4"></i>
              <div>
                <p class="font-semibold">User Comments</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Manage user feedback and discussion comments.</p>
              </div>
            </a>
            <a href="{% url 'view_contact_messages' %}" class="admin-link-card">
              <i class="fa-solid fa-headset text-3xl text-yellow-500 mr-4"></i>
              <div>
                <p class="font-semibold">Contact Requests</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">Review and reply to public contact form submissions.</p>
              </div>
            </a>
          </div>
        </div>
      </div>
      
      <!-- NEW: Collapsible Recent Content Sections -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
        
        <!-- Latest Questions Section -->
        <div class="collapsible-container bg-white dark:bg-gray-800 rounded-2xl shadow-lg border-t-4 border-l-4 border-green-500">
            <button class="collapsible-header w-full flex justify-between items-center p-4 text-left font-bold text-xl text-gray-800 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition duration-150" data-target="latest-questions-content">
                <span><i class="fa-solid fa-clipboard-list mr-2 text-green-500"></i> Latest Created Questions</span>
                <i class="fa-solid fa-chevron-down text-gray-400"></i>
            </button>
            <div id="latest-questions-content" class="collapsible-content space-y-2 p-4 hidden">
                {% for question in latest_questions %}
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition">
                        <a href="{% url 'quiz:Org_question_detail' question_uuid=question.question_uuid %}" class="block text-sm font-medium text-gray-900 dark:text-gray-100 truncate">
                            {{ forloop.counter }}. {{ question.question_text|striptags|truncatechars:80 }}
                        </a>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Created by: {{ question.creator.username }} on {{ question.created_at|date:"M d, H:i" }}
                        </p>
                    </div>
                {% empty %}
                    <p class="text-sm text-gray-500 dark:text-gray-400 p-2">No questions created recently by the organization.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Latest Question Papers Section -->
        <div class="collapsible-container bg-white dark:bg-gray-800 rounded-2xl shadow-lg border-t-4 border-l-4 border-blue-500">
            <button class="collapsible-header w-full flex justify-between items-center p-4 text-left font-bold text-xl text-gray-800 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition duration-150" data-target="latest-papers-content">
                <span><i class="fa-solid fa-file-invoice mr-2 text-blue-500"></i> Latest Created Question Papers</span>
                <i class="fa-solid fa-chevron-down text-gray-400"></i>
            </button>
            <div id="latest-papers-content" class="collapsible-content space-y-2 p-4 hidden">
                {% for paper in latest_papers %}
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition">
                        <a href="{% url 'quiz:paper_detail' paper_id=paper.id %}" class="block text-sm font-medium text-gray-900 dark:text-gray-100 truncate">
                            {{ forloop.counter }}. {{ paper.title }} 
                            {% if paper.is_published %}
                                <span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Published</span>
                            {% else %}
                                <span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Draft</span>
                            {% endif %}
                        </a>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Created by: {{ paper.creator.username }} on {{ paper.created_at|date:"M d, H:i" }}
                        </p>
                    </div>
                {% empty %}
                    <p class="text-sm text-gray-500 dark:text-gray-400 p-2">No question papers created recently by the organization.</p>
                {% endfor %}
            </div>
        </div>
      </div>
        
        <!-- 4. SYSTEM & SAAS MANAGEMENT (Superuser Only) -->
        {% if is_superuser %}
        <div class="lg:col-span-3 space-y-4 mt-8 pt-4 border-t border-gray-200 dark:border-gray-700">
          <h2 class="text-2xl font-bold text-red-600 dark:text-red-400">System Management (Superuser Only)</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
            <a href="{% url 'saas:organization_list' %}" class="admin-link-card bg-red-50 dark:bg-red-900/20 hover:ring-red-500">
              <i class="fa-solid fa-building text-3xl text-red-600 mr-4"></i>
              <div>
                <p class="font-semibold">Manage Organizations</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Manage all client organizations.</p>
              </div>
            </a>
            <a href="{% url 'saas:organization_license_overview' %}" class="admin-link-card bg-red-50 dark:bg-red-900/20 hover:ring-red-500">
              <i class="fa-solid fa-key text-3xl text-red-600 mr-4"></i>
              <div>
                <p class="font-semibold">License Dashboard</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">View and manage system licenses and usage.</p>
              </div>
            </a>
            <a href="{% url 'saas:create_ClientOrgination' %}" class="admin-link-card bg-red-50 dark:bg-red-900/20 hover:ring-red-500">
              <i class="fa-solid fa-handshake text-3xl text-red-600 mr-4"></i>
              <div>
                <p class="font-semibold">New Client Setup</p>
                <p class="text-sm text-gray-600 dark:text-gray-400">Create client organization and admin.</p>
              </div>
            </a>
          </div>
        </div>
        {% endif %}
    </div>

    <!-- Tab Panel 2: License & Usage -->
    <div id="tab-license-content" class="{% if current_tab != 'license' %}hidden{% endif %} space-y-8">
      
      <!-- License Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Question Papers Remaining (Total) -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 flex items-center justify-between border-l-4 border-green-500">
          <div class="space-y-1">
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Published Papers Remaining</p>
            <p class="text-4xl font-bold text-green-600 dark:text-green-400">{{ remaining_papers|default:"0" }}</p>
            <p class="text-xs text-gray-400 dark:text-gray-500">
              {{ current_papers_count }} used of {{ total_max_papers }} total
            </p>
          </div>
          <div class="w-12 h-12 bg-green-100 dark:bg-green-900/50 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-file-circle-check text-2xl text-green-600 dark:text-green-400"></i>
          </div>
        </div>

        <!-- Usage Limits (if set) -->
        {% if usage_limit %}
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 flex items-center justify-between border-l-4 border-indigo-500">
          <div class="space-y-1">
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Max Users</p>
            <p class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">{{ usage_limit.max_users }}</p>
            <p class="text-xs text-gray-400 dark:text-gray-500">
              {{ org_metrics.total_org_users }} current users
            </p>
          </div>
          <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-users-line text-2xl text-indigo-600 dark:text-indigo-400"></i>
          </div>
        </div>

        <!-- Remaining Draft Papers (UPDATED CARD) -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 flex items-center justify-between border-l-4 border-yellow-500">
          <div class="space-y-1">
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Remaining Draft Slots</p>
            <p class="text-4xl font-bold text-yellow-600 dark:text-yellow-400">{{ remaining_draft_papers|default:"0" }}</p>
            <p class="text-xs text-gray-400 dark:text-gray-500">
              {{ current_draft_papers_count }} used of {{ usage_limit.max_question_papers_drafts }} total
            </p>
          </div>
          <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/50 rounded-full flex items-center justify-center">
            <i class="fa-solid fa-folder-open text-2xl text-yellow-600 dark:text-yellow-400"></i>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Curriculum Usage Section -->
      {% if subject_usage or curriculum_usage %}
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
            <i class="fa-solid fa-chart-bar text-blue-500 mr-3"></i>
            Content & Curriculum Usage Analytics
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Shows resource utilization across different curriculum subjects and chapters (papers and questions).
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          
          <!-- Subject Usage -->
          {% if subject_usage %}
          <div class="space-y-3">
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 border-b pb-2">Subjects (Top {{ subject_usage|length }})</h3>
            {% for item in subject_usage %}
            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-2 border border-gray-100 dark:border-gray-600">
              <span class="font-bold text-lg text-gray-900 dark:text-gray-100 block">{{ item.subject.name }}</span>
              <div class="grid grid-cols-3 gap-2 text-xs font-medium text-gray-600 dark:text-gray-300">
                <span class="col-span-1">Papers: 
                    <span class="font-semibold text-blue-600 dark:text-blue-400">{{ item.paper_count }}</span>
                </span>
                <span class="col-span-1">Questions: 
                    <span class="font-semibold text-green-600 dark:text-green-400">{{ item.question_count }}</span>
                </span>
                <span class="col-span-1 text-right">Drafts: 
                    <span class="font-semibold text-yellow-600 dark:text-yellow-400">{{ item.draft_count }}</span>
                </span>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}

          <!-- Chapter Usage -->
          {% if curriculum_usage %}
          <div class="space-y-3">
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 border-b pb-2">Chapters (Top {{ curriculum_usage|length }})</h3>
            {% for item in curriculum_usage %}
            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg space-y-2 border border-gray-100 dark:border-gray-600">
                <div class="flex justify-between items-center">
                    <span class="font-bold text-lg text-gray-900 dark:text-gray-100">{{ item.chapter.name }}</span>
                    <span class="text-xs text-gray-400 dark:text-gray-500 italic">({{ item.subject }})</span>
                </div>
              <div class="grid grid-cols-3 gap-2 text-xs font-medium text-gray-600 dark:text-gray-300">
                <span class="col-span-1">Papers: 
                    <span class="font-semibold text-blue-600 dark:text-blue-400">{{ item.paper_count }}</span>
                </span>
                <span class="col-span-1">Questions: 
                    <span class="font-semibold text-green-600 dark:text-green-400">{{ item.question_count }}</span>
                </span>
                <span class="col-span-1 text-right">Drafts: 
                    <span class="font-semibold text-yellow-600 dark:text-yellow-400">{{ item.draft_count }}</span>
                </span>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}

        </div>
      </div>
      {% else %}
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center">
                <i class="fa-solid fa-chart-bar text-blue-500 mr-3"></i>
                Content & Curriculum Usage Analytics
            </h2>
            <p class="text-gray-500 dark:text-gray-400 p-4 border border-gray-300 dark:border-gray-600 rounded-lg">
                No papers or questions have been tracked yet for curriculum usage. Usage data will appear here after content is created.
            </p>
        </div>
      {% endif %}

      <!-- License Grants Table -->
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
        <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">Active License Grants</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">License ID</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Licensed Nodes</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Max Papers</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Purchased On</th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Valid Until</th>
              </tr>
            </thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
              {% for grant in license_grants %}
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">{{ grant.id }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">
                    <div class="flex flex-wrap gap-1">
                      {% for node in grant.curriculum_node.all %}
                        <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-2 py-0.5 rounded-full">{{ node.name }}</span>
                      {% empty %}
                        <span class="text-xs italic text-gray-400">All</span>
                      {% endfor %}
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ grant.max_question_papers }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ grant.purchased_on|date:"M d, Y" }}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">
                    {% if grant.valid_until %}
                      {{ grant.valid_until|date:"M d, Y" }}
                    {% else %}
                      <span class="italic text-gray-400">No Expiry</span>
                    {% endif %}
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400">
                    No license grants found for this organization.
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
  </div>
</div>

<script>
    // JavaScript for Collapsible Sections
    function setupCollapsibles() {
        document.querySelectorAll('.collapsible-header').forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.getAttribute('data-target');
                const targetContent = document.getElementById(targetId);
                
                if (targetContent) {
                    targetContent.classList.toggle('hidden');
                    
                    // Optional: change icon direction
                    const icon = button.querySelector('i.fa-chevron-down, i.fa-chevron-up');
                    if (icon) {
                        icon.classList.toggle('fa-chevron-down');
                        icon.classList.toggle('fa-chevron-up');
                    }
                }
            });
        });
    }

    // Ensure the setup runs after the page loads
    window.onload = setupCollapsibles;
</script>

<style>
/* Custom styles for the Admin Link Cards */
.admin-link-card {
  display: flex;
  align-items: center;
  padding: 1rem;
  background-color: white;
  border-radius: 0.75rem; /* rounded-xl */
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-lg */
  transition: all 0.3s ease-in-out;
  border: 1px solid rgb(229 231 235);
}

.admin-link-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
  border-color: #2563EB; /* blue-600 */
  z-index: 10;
  position: relative;
  background-color: #f7f9fe;
}

/* Dark Mode Adjustments */
.dark .admin-link-card {
  background-color: rgb(31 41 55); /* dark:bg-gray-800 */
  border-color: rgb(55 65 81); /* dark:border-gray-700 */
}
.dark .admin-link-card:hover {
  background-color: rgb(17 24 39); /* darker background on hover */
  border-color: #60A5FA; /* blue-400 */
}

/* Metric Card Styles (New) */
.metric-card {
    background-color: white;
    padding: 1rem;
    border-radius: 0.75rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-left: 4px solid;
    transition: transform 0.2s;
}
.metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}
.dark .metric-card {
    background-color: rgb(31 41 55);
}

/* Collapsible Section Styles */
.collapsible-header {
    cursor: pointer;
    border-bottom: 1px solid transparent;
}
.collapsible-header:focus {
    outline: none;
}

</style>
{% endblock %}